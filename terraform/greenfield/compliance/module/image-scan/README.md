Solution overview

This automated image compliance solution for Amazon EKS and Amazon ECS is based on automation of the detection and remediation of Amazon ECR Image Scan events using AWS CloudWatch events and AWS Security Hub Custom Actions. It consists of one terraform script (translated from AWS Cloudformation template) that fully automates the provisioning, setup, and integration of all the components necessary for this solution.

The following architecture illustrates the components of our solution and how they integrate with each other. As shown in the architecture, the solution generates an AWS Security Hub finding whenever a vulnerable image is scanned in ECR. This is either when an ECR repository is configured for a scan on push or via a manual scan of the image. The solution provisions an Amazon CloudWatch Events (EventBridge) Rule that gets triggered based on a Amazon ECR Event for a completed image scan. The target for the Amazon CloudWatch Events (EventBridge) Rule is an AWS Lambda function that translates the event from the image scan into an AWS Security Finding Format for AWS Security Hub. The solution also provisions an AWS Security Hub Custom Action for remediation. The Security Hub based remediation attaches an Amazon ECR Repository policy as soon the remediation action is invoked, and the policy is scoped for controlling access to the specific repository where the vulnerable image is detected.

![alt text](https://d2908q01vomqb2.cloudfront.net/fe2ef495a1152561572949784c16bf23abb28057/2021/01/01/ECRSecurityHub-archdiagram.png)

Plesae see https://aws.amazon.com/blogs/containers/automating-image-compliance-for-amazon-eks-using-amazon-elastic-container-registry-and-aws-security-hub/#:~:text=These%20vulnerabilities%20are%20classified%20as,pushed%20to%20AWS%20Security%20Hub for more soulution details 